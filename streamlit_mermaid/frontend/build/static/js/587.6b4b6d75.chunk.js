"use strict";(self.webpackChunkmermaid_viewer=self.webpackChunkmermaid_viewer||[]).push([[587],{4254:function(e,n,r){var t=r(680);n.Z=function(e){return(0,t.Z)(e,4)}},3587:function(e,n,r){r.r(n),r.d(n,{render:function(){return B}});var t=r(4165),a=r(1413),i=r(5861),c=r(7762),o=r(3433),d=r(4225),s=(r(9473),r(638)),u=r(1278),l=(r(1727),r(2943),r(8535),r(6699)),f=r(1025),g=r(9827),p=r(2790),h=r(4254),v=r(4625);r(9738);function w(e){var n={options:{directed:e.isDirected(),multigraph:e.isMultigraph(),compound:e.isCompound()},nodes:M(e),edges:y(e)};return p.Z(e.graph())||(n.value=h.Z(e.graph())),n}function M(e){return v.Z(e.nodes(),(function(n){var r=e.node(n),t=e.parent(n),a={v:n};return p.Z(r)||(a.value=r),p.Z(t)||(a.parent=t),a}))}function y(e){return v.Z(e.edges(),(function(n){var r=e.edge(n),t={v:n.v,w:n.w};return p.Z(n.name)||(t.name=n.name),p.Z(r)||(t.value=r),t}))}var m=r(8433),X=new Map,x=new Map,b=new Map,Z=(0,f.eW)((function(){x.clear(),b.clear(),X.clear()}),"clear"),E=(0,f.eW)((function(e,n){var r=x.get(n)||[];return f.cM.trace("In isDescendant",n," ",e," = ",r.includes(e)),r.includes(e)}),"isDescendant"),N=(0,f.eW)((function(e,n){var r=x.get(n)||[];return f.cM.info("Descendants of ",n," is ",r),f.cM.info("Edge is ",e),e.v!==n&&e.w!==n&&(r?r.includes(e.v)||E(e.v,n)||E(e.w,n)||r.includes(e.w):(f.cM.debug("Tilt, ",n,",not in descendants"),!1))}),"edgeInCluster"),k=(0,f.eW)((function(e,n,r,t){f.cM.warn("Copying children of ",e,"root",t,"data",n.node(e),t);var a=n.children(e)||[];e!==t&&a.push(e),f.cM.warn("Copying (nodes) clusterId",e,"nodes",a),a.forEach((function(a){if(n.children(a).length>0)k(a,n,r,t);else{var i=n.node(a);f.cM.info("cp ",a," to ",t," with parent ",e),r.setNode(a,i),t!==n.parent(a)&&(f.cM.warn("Setting parent",a,n.parent(a)),r.setParent(a,n.parent(a))),e!==t&&a!==e?(f.cM.debug("Setting parent",a,e),r.setParent(a,e)):(f.cM.info("In copy ",e,"root",t,"data",n.node(e),t),f.cM.debug("Not Setting parent for node=",a,"cluster!==rootId",e!==t,"node!==clusterId",a!==e));var c=n.edges(a);f.cM.debug("Copying Edges",c),c.forEach((function(a){f.cM.info("Edge",a);var i=n.edge(a.v,a.w,a.name);f.cM.info("Edge data",i,t);try{N(a,t)?(f.cM.info("Copying as ",a.v,a.w,i,a.name),r.setEdge(a.v,a.w,i,a.name),f.cM.info("newGraph edges ",r.edges(),r.edge(r.edges()[0]))):f.cM.info("Skipping copy of edge ",a.v,"--\x3e",a.w," rootId: ",t," clusterId:",e)}catch(c){f.cM.error(c)}}))}f.cM.debug("Removing node",a),n.removeNode(a)}))}),"copy"),C=(0,f.eW)((function(e,n){var r,t=n.children(e),a=(0,o.Z)(t),i=(0,c.Z)(t);try{for(i.s();!(r=i.n()).done;){var d=r.value;b.set(d,e),a=[].concat((0,o.Z)(a),(0,o.Z)(C(d,n)))}}catch(s){i.e(s)}finally{i.f()}return a}),"extractDescendants"),S=(0,f.eW)((function(e,n,r){var t=e.edges().filter((function(e){return e.v===n||e.w===n})),a=e.edges().filter((function(e){return e.v===r||e.w===r})),i=t.map((function(e){return{v:e.v===n?r:e.v,w:e.w===n?n:e.w}})),c=a.map((function(e){return{v:e.v,w:e.w}}));return i.filter((function(e){return c.some((function(n){return e.v===n.v&&e.w===n.w}))}))}),"findCommonEdges"),I=(0,f.eW)((function(e,n,r){var t,a=n.children(e);if(f.cM.trace("Searching children of id ",e,a),a.length<1)return e;var i,o=(0,c.Z)(a);try{for(o.s();!(i=o.n()).done;){var d=i.value,s=I(d,n,r),u=S(n,r,s);if(s){if(!(u.length>0))return s;t=s}}}catch(l){o.e(l)}finally{o.f()}return t}),"findNonClusterChild"),D=(0,f.eW)((function(e){return X.has(e)&&X.get(e).externalConnections&&X.has(e)?X.get(e).id:e}),"getAnchorId"),O=(0,f.eW)((function(e,n){if(!e||n>10)f.cM.debug("Opting out, no graph ");else{f.cM.debug("Opting in, graph "),e.nodes().forEach((function(n){e.children(n).length>0&&(f.cM.warn("Cluster identified",n," Replacement id in edges: ",I(n,e,n)),x.set(n,C(n,e)),X.set(n,{id:I(n,e,n),clusterData:e.node(n)}))})),e.nodes().forEach((function(n){var r=e.children(n),t=e.edges();r.length>0?(f.cM.debug("Cluster identified",n,x),t.forEach((function(e){E(e.v,n)^E(e.w,n)&&(f.cM.warn("Edge: ",e," leaves cluster ",n),f.cM.warn("Descendants of XXX ",n,": ",x.get(n)),X.get(n).externalConnections=!0)}))):f.cM.debug("Not a cluster ",n,x)}));var r,t=(0,c.Z)(X.keys());try{for(t.s();!(r=t.n()).done;){var a=r.value,i=X.get(a).id,o=e.parent(i);o!==a&&X.has(o)&&!X.get(o).externalConnections&&(X.get(a).id=o)}}catch(d){t.e(d)}finally{t.f()}e.edges().forEach((function(n){var r=e.edge(n);f.cM.warn("Edge "+n.v+" -> "+n.w+": "+JSON.stringify(n)),f.cM.warn("Edge "+n.v+" -> "+n.w+": "+JSON.stringify(e.edge(n)));var t=n.v,a=n.w;if(f.cM.warn("Fix XXX",X,"ids:",n.v,n.w,"Translating: ",X.get(n.v)," --- ",X.get(n.w)),X.get(n.v)||X.get(n.w)){if(f.cM.warn("Fixing and trying - removing XXX",n.v,n.w,n.name),t=D(n.v),a=D(n.w),e.removeEdge(n.v,n.w,n.name),t!==n.v){var i=e.parent(t);X.get(i).externalConnections=!0,r.fromCluster=n.v}if(a!==n.w){var c=e.parent(a);X.get(c).externalConnections=!0,r.toCluster=n.w}f.cM.warn("Fix Replacing with XXX",t,a,n.name),e.setEdge(t,a,r,n.name)}})),f.cM.warn("Adjusted Graph",w(e)),W(e,0),f.cM.trace(X)}}),"adjustClustersAndEdges"),W=(0,f.eW)((function(e,n){if(f.cM.warn("extractor - ",n,w(e),e.children("D")),n>10)f.cM.error("Bailing out");else{var r,t=e.nodes(),a=!1,i=(0,c.Z)(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,d=e.children(o);a=a||d.length>0}}catch(b){i.e(b)}finally{i.f()}if(a){f.cM.debug("Nodes = ",t,n);var s,u=(0,c.Z)(t);try{for(u.s();!(s=u.n()).done;){var l=s.value;if(f.cM.debug("Extracting node",l,X,X.has(l)&&!X.get(l).externalConnections,!e.parent(l),e.node(l),e.children("D")," Depth ",n),X.has(l))if(!X.get(l).externalConnections&&e.children(l)&&e.children(l).length>0){var g;f.cM.warn("Cluster without external connections, without a parent and with children",l,n);var p="TB"===e.graph().rankdir?"LR":"TB";null!==(g=X.get(l))&&void 0!==g&&null!==(g=g.clusterData)&&void 0!==g&&g.dir&&(p=X.get(l).clusterData.dir,f.cM.warn("Fixing dir",X.get(l).clusterData.dir,p));var h=new m.k({multigraph:!0,compound:!0}).setGraph({rankdir:p,nodesep:50,ranksep:50,marginx:8,marginy:8}).setDefaultEdgeLabel((function(){return{}}));f.cM.warn("Old graph before copy",w(e)),k(l,e,h,l),e.setNode(l,{clusterNode:!0,id:l,clusterData:X.get(l).clusterData,label:X.get(l).label,graph:h}),f.cM.warn("New graph after copy node: (",l,")",w(h)),f.cM.debug("Old graph after copy",w(e))}else f.cM.warn("Cluster ** ",l," **not meeting the criteria !externalConnections:",!X.get(l).externalConnections," no parent: ",!e.parent(l)," children ",e.children(l)&&e.children(l).length>0,e.children("D"),n),f.cM.debug(X);else f.cM.debug("Not a cluster",l,n)}}catch(b){u.e(b)}finally{u.f()}t=e.nodes(),f.cM.warn("New list of nodes",t);var v,M=(0,c.Z)(t);try{for(M.s();!(v=M.n()).done;){var y=v.value,x=e.node(y);f.cM.warn(" Now next level",y,x),null!==x&&void 0!==x&&x.clusterNode&&W(x.graph,n+1)}}catch(b){M.e(b)}finally{M.f()}}else f.cM.debug("Done, no node has children",e.nodes())}}),"extractor"),G=(0,f.eW)((function(e,n){if(0===n.length)return[];var r=Object.assign([],n);return n.forEach((function(n){var t=e.children(n),a=G(e,t);r=[].concat((0,o.Z)(r),(0,o.Z)(a))})),r}),"sorter"),P=(0,f.eW)((function(e){return G(e,e.children())}),"sortNodesByHierarchy"),J=(0,f.eW)(function(){var e=(0,i.Z)((0,t.Z)().mark((function e(n,r,c,o,l,p){var h,v,M,y,m,x,b,Z,E,N;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.cM.warn("Graph in recursive render:XAX",w(r),l),h=r.graph().rankdir,f.cM.trace("Dir in recursive render - dir:",h),v=n.insert("g").attr("class","root"),r.nodes()?f.cM.info("Recursive render XXX",r.nodes()):f.cM.info("No nodes found for",r),r.edges().length>0&&f.cM.info("Recursive edges",r.edge(r.edges()[0])),M=v.insert("g").attr("class","clusters"),y=v.insert("g").attr("class","edgePaths"),m=v.insert("g").attr("class","edgeLabels"),x=v.insert("g").attr("class","nodes"),e.next=12,Promise.all(r.nodes().map(function(){var e=(0,i.Z)((0,t.Z)().mark((function e(n){var i,d,u,g,v,w,M;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.node(n),void 0!==l&&(d=JSON.parse(JSON.stringify(l.clusterData)),f.cM.trace("Setting data for parent cluster XXX\n Node.id = ",n,"\n data=",d.height,"\nParent cluster",l.height),r.setNode(l.id,d),r.parent(n)||(f.cM.trace("Setting parent",n,l.id),r.setParent(n,l.id,d))),f.cM.info("(Insert) Node XXX"+n+": "+JSON.stringify(r.node(n))),null===i||void 0===i||!i.clusterNode){e.next=17;break}return f.cM.info("Cluster identified XBX",n,i.width,r.node(n)),u=r.graph(),g=u.ranksep,v=u.nodesep,i.graph.setGraph((0,a.Z)((0,a.Z)({},i.graph.graph()),{},{ranksep:g+25,nodesep:v})),e.next=9,J(x,i.graph,c,o,r.node(n),p);case 9:w=e.sent,M=w.elem,(0,s.jr)(i,M),i.diff=w.diff||0,f.cM.info("New compound node after recursive render XAX",n,"width",i.width,"height",i.height),(0,s.Yn)(M,i),e.next=26;break;case 17:if(!(r.children(n).length>0)){e.next=23;break}f.cM.trace("Cluster - the non recursive path XBX",n,i.id,i,i.width,"Graph:",r),f.cM.trace(I(i.id,r)),X.set(i.id,{id:I(i.id,r),node:i}),e.next=26;break;case 23:return f.cM.trace("Node - the non recursive path XAX",n,x,r.node(n),h),e.next=26,(0,s.Lf)(x,r.node(n),{config:p,dir:h});case 26:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()));case 12:return b=(0,f.eW)((0,i.Z)((0,t.Z)().mark((function e(){var n;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.edges().map(function(){var e=(0,i.Z)((0,t.Z)().mark((function e(n){var a;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.edge(n.v,n.w,n.name),f.cM.info("Edge "+n.v+" -> "+n.w+": "+JSON.stringify(n)),f.cM.info("Edge "+n.v+" -> "+n.w+": ",n," ",JSON.stringify(r.edge(n))),f.cM.info("Fix",X,"ids:",n.v,n.w,"Translating: ",X.get(n.v),X.get(n.w)),e.next=6,(0,d.I_)(m,a);case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),e.next=3,Promise.all(n);case 3:case"end":return e.stop()}}),e)}))),"processEdges"),e.next=15,b();case 15:return f.cM.info("Graph before layout:",JSON.stringify(w(r))),f.cM.info("############################################# XXX"),f.cM.info("###                Layout                 ### XXX"),f.cM.info("############################################# XXX"),(0,g.bK)(r),f.cM.info("Graph after layout:",JSON.stringify(w(r))),Z=0,E=(0,u.L)(p),N=E.subGraphTitleTotalMargin,e.next=25,Promise.all(P(r).map(function(){var e=(0,i.Z)((0,t.Z)().mark((function e(n){var a,i,c,o,d,u;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.node(n),f.cM.info("Position XBX => "+n+": ("+a.x,","+a.y,") width: ",a.width," height: ",a.height),null===a||void 0===a||!a.clusterNode){e.next=9;break}a.y+=N,f.cM.info("A tainted cluster node XBX1",n,a.id,a.width,a.height,a.x,a.y,r.parent(n)),X.get(a.id).node=a,(0,s.aH)(a),e.next=26;break;case 9:if(!(r.children(n).length>0)){e.next=22;break}return f.cM.info("A pure cluster node XBX1",n,a.id,a.x,a.y,a.width,a.height,r.parent(n)),a.height+=N,r.node(a.parentId),c=(null===a||void 0===a?void 0:a.padding)/2||0,o=(null===a||void 0===a||null===(i=a.labelBBox)||void 0===i?void 0:i.height)||0,d=o-c||0,f.cM.debug("OffsetY",d,"labelHeight",o,"halfPadding",c),e.next=19,(0,s.us)(M,a);case 19:X.get(a.id).node=a,e.next=26;break;case 22:u=r.node(a.parentId),a.y+=N/2,f.cM.info("A regular node XBX1 - using the padding",a.id,"parent",a.parentId,a.width,a.height,a.x,a.y,"offsetY",a.offsetY,"parent",u,null===u||void 0===u?void 0:u.offsetY,a),(0,s.aH)(a);case 26:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()));case 25:return r.edges().forEach((function(e){var n=r.edge(e);f.cM.info("Edge "+e.v+" -> "+e.w+": "+JSON.stringify(n),n),n.points.forEach((function(e){return e.y+=N/2}));var t=r.node(e.v),a=r.node(e.w),i=(0,d.QP)(y,n,X,c,t,a,o);(0,d.Jj)(n,i)})),r.nodes().forEach((function(e){var n=r.node(e);f.cM.info(e,n.type,n.diff),n.isGroup&&(Z=n.diff)})),f.cM.warn("Returning from recursive render XAX",v,Z),e.abrupt("return",{elem:v,diff:Z});case 29:case"end":return e.stop()}}),e)})));return function(n,r,t,a,i,c){return e.apply(this,arguments)}}(),"recursiveRender"),B=(0,f.eW)(function(){var e=(0,i.Z)((0,t.Z)().mark((function e(n,r){var i,c,o,u,g,p,h;return(0,t.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g=new m.k({multigraph:!0,compound:!0}).setGraph({rankdir:n.direction,nodesep:(null===(i=n.config)||void 0===i?void 0:i.nodeSpacing)||(null===(c=n.config)||void 0===c||null===(c=c.flowchart)||void 0===c?void 0:c.nodeSpacing)||n.nodeSpacing,ranksep:(null===(o=n.config)||void 0===o?void 0:o.rankSpacing)||(null===(u=n.config)||void 0===u||null===(u=u.flowchart)||void 0===u?void 0:u.rankSpacing)||n.rankSpacing,marginx:8,marginy:8}).setDefaultEdgeLabel((function(){return{}})),p=r.select("g"),(0,d.DQ)(p,n.markers,n.type,n.diagramId),(0,s.gU)(),(0,d.ZH)(),(0,s.ZH)(),Z(),n.nodes.forEach((function(e){g.setNode(e.id,(0,a.Z)({},e)),e.parentId&&g.setParent(e.id,e.parentId)})),f.cM.debug("Edges:",n.edges),n.edges.forEach((function(e){if(e.start===e.end){var n=e.start,r=n+"---"+n+"---1",t=n+"---"+n+"---2",i=g.node(n);g.setNode(r,{domId:r,id:r,parentId:i.parentId,labelStyle:"",label:"",padding:0,shape:"labelRect",style:"",width:10,height:10}),g.setParent(r,i.parentId),g.setNode(t,{domId:t,id:t,parentId:i.parentId,labelStyle:"",padding:0,shape:"labelRect",label:"",style:"",width:10,height:10}),g.setParent(t,i.parentId);var c=structuredClone(e),o=structuredClone(e),d=structuredClone(e);c.label="",c.arrowTypeEnd="none",c.id=n+"-cyclic-special-1",o.arrowTypeStart="none",o.arrowTypeEnd="none",o.id=n+"-cyclic-special-mid",d.label="",i.isGroup&&(c.fromCluster=n,d.toCluster=n),d.id=n+"-cyclic-special-2",d.arrowTypeStart="none",g.setEdge(n,r,c,n+"-cyclic-special-0"),g.setEdge(r,t,o,n+"-cyclic-special-1"),g.setEdge(t,n,d,n+"-cyc<lic-special-2")}else g.setEdge(e.start,e.end,(0,a.Z)({},e),e.id)})),f.cM.warn("Graph at first:",JSON.stringify(w(g))),O(g),f.cM.warn("Graph after XAX:",JSON.stringify(w(g))),h=(0,l.nV)(),e.next=16,J(p,g,n.type,n.diagramId,void 0,h);case 16:case"end":return e.stop()}}),e)})));return function(n,r){return e.apply(this,arguments)}}(),"render")}}]);
//# sourceMappingURL=587.6b4b6d75.chunk.js.map